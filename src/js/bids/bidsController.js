import * as view from './bidsView';
import Bids from './bidsModel';

export default async function(state){
    // Создаем объект модели для работы с заявками
    if(!state.bids){
        state.bids = new Bids();
    }

    // Получаем заявки с сервера
    await state.bids.getBits();

    // Рендерим контейнер для заявок на странице
    view.renderContainer();

    const bidsOnPage = 10;
    const star = (state.pagination.currentPageNum - 1) * bidsOnPage;
    const end = star + bidsOnPage
    // Рендерим заявки на странице 
    state.bids.bids.slice(star, end).forEach(element => {
        view.renderBid(element)
    });

    state.emitter.subscribe('event:render-bids', ({pageNum})=>{
        // Определяет количество заявок на странице                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        const bidsOnPage = 10;
        const star = (pageNum - 1) * bidsOnPage;
        const end = star + bidsOnPage

        // Очищаем контейнер с заявками
        view.clearBidsContainer()

        //Отображаем заявки на странице
        // Определение завок, которые будут отображаться на странице при каждом клике по элементам пагинации, происходит по 2 параметрам: количество заявок на странице - bidsOnPage, номер по которому произошел клик - pageNum.
        state.bids.bids.slice(star, end).forEach(element => {
            view.renderBid(element)
        });
    })
}